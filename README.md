# malware-domain-detection
Detection of malicious domains via character co-occurrence analysis in URL's.

This package consists of 2 python scripts:

1. **generate_character_pair_counts.py**

The script analyzes the Alexa Top 1 million websites available at:
`http://s3.amazonaws.com/alexa-static/top-1m.csv.zip`
It computes the pair-wise co-occurence frequency of each consecutive characters as described in [this article](http://blog.exabeam.com/using-data-science-to-detect-malicious-domains):

The computed pair-wise co-occurence probabilities are stored in json format in the output file `character_pair_probabilities.json` for use in analyzing potential URLs that may host malware.

2. **malware_domain_detection.py**

This script reads in an input file consisting of 1 URL per line.
It parses the URL and attempts to evaluate whether any part of the URL
(domain or path) may be malicious.

It does this by computing the pairwise co-occurence of strings in the URL.
Each string contains multiple pairs which are compared against the probabilities of seeing those pairs among the top 1 million sites as per Alexa.com

Rare pairs of characters have a low probability, and thus a higher score. If a pair is not found from the computed pairs within `character_pair_probabilities.json`, it is arbitrarily assigned a high score (-5)

The final `malware_score` for each string is calculated as follows:
`exp(score/length of string)`

My observations indicate that if a string from the URL returns a `malware_score` greater than 15, the URL may be considered to be serving malware of some form.

## Installation
Clone the repo: 

`git clone https://github.com/amitdeshmukh/malware-domain-detection.git`

## Download the Alexa Top 1 million sites list from
The most up to date list is available from 
`http://s3.amazonaws.com/alexa-static/top-1m.csv.zip`

## Generate the pair-wise co-occurence probabilities
Before running this script, ensure that the proper filename has been provided.
Refer to the variable name `file`

`python generate_character_pair_counts.py`

You should now have an output file `character_pair_probabilities.json`
This file contains the `count` of a character pair, the percentage of times the count was observed in the entire collection or `probability` and the `log` of the probability.

## Compute scores
Given a list of URL's stored in a file, one URL per line, we can test if a part of the URL may be malicious.

`python malware_domain_detection.py`

## Result
```
-- Read json --
-- Fetched latest ICANN TLDs --

URL                ==>  lahmar.choukri.perso.neuf.fr/78hg4wg
DOMAIN             ==>  lahmar.choukri.perso.neuf
PATH               ==>  /78hg4wg
EVALUATING WORDS   ==>  ['lahmar', 'choukri', 'perso', 'neuf', '78hg4wg']
POSSIBLY MALICIOUS ==>  78hg4wg 45.087


URL                ==>  www.weforwomenmarathon.org/
DOMAIN             ==>  weforwomenmarathon
PATH               ==>  /
EVALUATING WORDS   ==>  ['weforwomenmarathon']


URL                ==>  www.icybrand.eu/pathway/created/accelerated/mailuserlg/savealife/trwrwbejtw/viewer
DOMAIN             ==>  icybrand
PATH               ==>  /pathway/created/accelerated/mailuserlg/savealife/trwrwbejtw/viewer
EVALUATING WORDS   ==>  ['icybrand', 'pathway', 'created', 'accelerated', 'mailuserlg', 'savealife', 'trwrwbejtw', 'viewer']
POSSIBLY MALICIOUS ==>  trwrwbejtw 20.337


URL                ==>  http://backup.terra5llc.com/takemeto/heaven.php
DOMAIN             ==>  backup.terra5llc
PATH               ==>  /takemeto/heaven.php
EVALUATING WORDS   ==>  ['backup', 'terra5llc', 'takemeto', 'heaven', 'php']


URL                ==>  http://marialorena.com.br/wp-content/plugins/hello123/8888ytc6r.exe
DOMAIN             ==>  marialorena.com
PATH               ==>  /wp-content/plugins/hello123/8888ytc6r.exe
EVALUATING WORDS   ==>  ['marialorena', 'com', 'wp', 'content', 'plugins', 'hello123', '8888ytc6r', 'exe']
POSSIBLY MALICIOUS ==>  8888ytc6r 36.597


URL                ==>  http://naairah.com/wp-content/plugins/hello123/j7u7h54h5.exe
DOMAIN             ==>  naairah
PATH               ==>  /wp-content/plugins/hello123/j7u7h54h5.exe
EVALUATING WORDS   ==>  ['naairah', 'wp', 'content', 'plugins', 'hello123', 'j7u7h54h5', 'exe']
POSSIBLY MALICIOUS ==>  j7u7h54h5 80.87


URL                ==>  http://zt.tim-taxi.com/login.php
DOMAIN             ==>  zt.tim-taxi
PATH               ==>  /login.php
EVALUATING WORDS   ==>  ['zt', 'tim', 'taxi', 'login', 'php']


URL                ==>  jktdc.in/images/klb/azxvas.gif
DOMAIN             ==>  jktdc
PATH               ==>  /images/klb/azxvas.gif
EVALUATING WORDS   ==>  ['jktdc', 'images', 'klb', 'azxvas', 'gif']
POSSIBLY MALICIOUS ==>  jktdc 16.367
POSSIBLY MALICIOUS ==>  azxvas 15.159
```

## References
1. Exabeam blog article [http://blog.exabeam.com/using-data-science-to-detect-malicious-domains](http://blog.exabeam.com/using-data-science-to-detect-malicious-domains)

2. Angler domains \[Cisco\] [http://blogs.cisco.com/wp-content/uploads/angler_domains.txt](http://blogs.cisco.com/wp-content/uploads/angler_domains.txt)

3. Malwaredomains.com
